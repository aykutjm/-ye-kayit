<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atakum Tenis Kulübü - Üyelik Sözleşmesi</title>
    <!-- Yüksek Kaliteli Resim için html2canvas kütüphanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --dark-green: #2d5a27;
            --light-green: #4a7c59;
            --light-bg: #f8f9ff;
            --border-color: #e1e5e9;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); min-height: 100vh; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, var(--dark-green) 0%, var(--light-green) 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .form-container { padding: 40px; }
        .form-section { margin-bottom: 30px; padding: 25px; border-radius: 15px; background: var(--light-bg); border-left: 5px solid var(--primary-color); }
        .section-title { font-size: 1.4em; color: var(--dark-green); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; font-size: 0.95em; }
        input, select, textarea { padding: 12px 15px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 1em; transition: all 0.3s ease; width: 100%; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .contract-text { background: white; padding: 25px; border-radius: 10px; border: 2px solid var(--border-color); height: 400px; overflow-y: auto; font-size: 0.85em; line-height: 1.6; }
        .signature-section { background: #fff; border: 2px dashed var(--primary-color); border-radius: 15px; padding: 30px; text-align: center; }
        .signature-canvas { border: 2px solid var(--border-color); border-radius: 10px; cursor: crosshair; display: block; margin: 20px auto; max-width: 100%; }
        .btn { padding: 12px 25px; border: none; border-radius: 25px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-secondary { background: #f8f9fa; color: #6c757d; border: 2px solid var(--border-color); }
        .btn-success { background: linear-gradient(135deg, #28a745 0%, #20c997 100%); color: white; font-size: 1.2em; padding: 15px 40px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .checkbox-group { display: flex; align-items: flex-start; gap: 15px; margin-top: 20px; }
        .checkbox-group input { width: 20px; height: 20px; margin-top: 3px; flex-shrink: 0;}
        .warning, .info-box { background: #fff3cd; border-left: 5px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 10px; margin: 15px 0; }
        .success-message { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 20px; border-radius: 15px; text-align: center; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    
    <div class="container" id="main-container">
        <div class="header">
            <h1>🎾 Atakum Tenis Kulübü</h1>
            <p>Online Üyelik Sözleşmesi</p>
        </div>
        <div class="form-container">
            <form id="membershipForm">
                <div class="form-section">
                    <h3 class="section-title">👤 Üye / Veli Bilgileri</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="fullName">Ad Soyad *</label><input type="text" id="fullName" name="Ad_Soyad" required></div>
                        <div class="form-group"><label for="tcno">T.C. Kimlik No *</label><input type="text" id="tcno" name="TC_Kimlik_No" pattern="[0-9]{11}" maxlength="11" required></div>
                        <div class="form-group"><label for="phone">Telefon *</label><input type="tel" id="phone" name="Telefon" required></div>
                        <div class="form-group"><label for="email">E-posta *</label><input type="email" id="email" name="Eposta" required></div>
                    </div>
                    <div class="form-group" style="margin-top: 20px;"><label for="address">Adres *</label><textarea id="address" name="Adres" rows="3" required></textarea></div>
                </div>
                 <div class="form-section">
                    <h3 class="section-title">🗓️ Üyelik Süresi</h3>
                    <div class="form-group">
                        <label for="membershipDuration">Üyelik Süresini Seçiniz *</label>
                        <select id="membershipDuration" name="Uyelik_Suresi" required>
                            <option value="">Seçiniz...</option>
                            <option value="Aylık">Aylık</option>
                            <option value="4 Aylık">4 Aylık</option>
                        </select>
                    </div>
                    <div id="monthlyWarning" class="info-box" style="display: none;"><strong>Bilgilendirme:</strong> Aylık üyeliklerde, üyeliğinizi sonlandırmak için her ayın 14'üne kadar kayıt sildirmeniz gerekmektedir. Aksi takdirde üyelik otomatik olarak yenilenir.</div>
                    <div id="fourMonthWarning" class="info-box" style="display: none;"><strong>Bilgilendirme:</strong> 4 aylık üyeliklerde, süreden önce iptal edilen üyeliklerde sözleşme gereği cayma bedeli tahsil edilir.</div>
                </div>
                 <div class="form-section">
                    <h3 class="section-title">👶 Reşit Olmayan Üye</h3>
                    <div class="checkbox-group">
                        <input type="checkbox" id="isMinorCheck" name="Resit_Olmayan_Uye_Mi">
                        <label for="isMinorCheck">18 yaşından küçük bir üye için dolduruyorum.</label>
                    </div>
                    <div id="minorFields" style="display: none; margin-top: 20px;">
                        <div class="form-grid">
                            <div class="form-group"><label for="minorFullName">Reşit Olmayanın Adı Soyadı *</label><input type="text" id="minorFullName" name="Resit_Olmayan_Adi_Soyadi"></div>
                            <div class="form-group"><label for="minorDob">Reşit Olmayanın Doğum Tarihi *</label><input type="date" id="minorDob" name="Resit_Olmayan_Dogum_Tarihi"></div>
                        </div>
                    </div>
                </div>
                 <div class="form-section">
                    <h3 class="section-title">📋 Üyelik Sözleşmesi</h3>
                    <div class="contract-text" id="contractTextArea"></div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="agreeContract" name="Sozlesme_Onayi" value="Kabul Edildi" required>
                        <label for="agreeContract">Üyelik sözleşmesini okudum, anladım ve kabul ediyorum. *</label>
                    </div>
                </div>
                 <div class="form-section">
                    <h3 class="section-title">✍️ Dijital İmza</h3>
                    <div class="signature-section">
                        <p>Lütfen aşağıdaki alana imzanızı atın:</p>
                        <canvas id="signatureCanvas" class="signature-canvas" width="400" height="200"></canvas>
                        <div><button type="button" class="btn btn-secondary" onclick="clearSignature()">İmzayı Temizle</button></div>
                        <div id="signatureWarning" class="warning" style="display: none; margin-top: 15px;"><strong>Uyarı:</strong> Lütfen dijital imzanızı tamamlayın.</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn btn-success" id="submitBtn">📄 Sözleşmeyi İmzala ve Onayla</button>
                </div>
                <div class="success-message" id="successMessage">
                    <h3>✅ Başarılı!</h3>
                    <p>Üyelik sözleşmeniz başarıyla tamamlandı. Onay belgesi indiriliyor ve bilgileriniz kulübümüze iletiliyor.</p>
                </div>
            </form>
        </div>
    </div>

<script>
    // --- SABİTLER ---
    const webhookUrl = 'https://n8n.edu-ai.online/webhook-test/10a31aa5-c942-46ec-bc5c-b221c24e5eae';
    const contractTextArea = document.getElementById('contractTextArea');
    
    // --- SÖZLEŞME METNİ ---
    const getContractSections = () => {
        // DÜZELTME: Sözleşme metninin tamamı geri eklendi ve 3 parçaya bölündü
        const part1 = `<h4>ÜYELİK SÖZLEŞMESİ</h4>
        <p><strong>1-) TARAFLAR</strong><br>
        <strong>A-KULÜP</strong><br>
        Adı-Soyadı : Aykut YILDIRIM<br>
        Ünvanı : Atakum Tenis<br>
        Adres : Derecik Mahallesi 1444. Sokak No:1 İlkadım/Samsun<br>
        Vergi No : 9540639540<br>
        Telefon : 0544 936 75 43<br>
        E-mail : y.aykut7455@gmail.com<br>
        Bu sözleşmede bundan sonra “EĞİTMEN/KULÜP” olarak anılacaktır.<br>
        <strong>B-ÜYE/VELİ</strong><br>
        Bu sözleşmede bundan sonra “ÜYE/VELİ” olarak anılacaktır. Üye ve varsa veliye ait bilgiler yukarıda yer alan kısma ayrı ayrı yazılarak doldurulacaktır.</p>
        <p>Üye/Veli işbu sözleşmeyi onaylaması sırasında Eğitmen tarafından kendisinden talep edilen her türlü bilgiyi eksiksiz ve doğru olarak Eğitmene vermeyi kabul etmektedir. Üye/Veli, eğitimler sırasında Eğitmene bildirdiği bilgilerin doğruluğundan bizzat sorumludur.</p>
        <p><strong>2-) KONU</strong><br>
        İşbu üyelik sözleşmesi, üyelik işlemlerinin gerçekleştirilmesi ile işbu sözleşmenin onaylanması suretiyle, Eğitmen tarafından sunulacak hizmetin şartlarını ve tarafların karşılıklı hak ve yükümlülüklerini düzenlemektedir.</p>
        <p><strong>3-) SÜRE</strong><br>
        Sözleşme süresi aylık ve 6 aylık periyotlar halinde düzenlenmekte olup; kayıtlar sözleşmenin biteceği ayın 15’inden önce iptal edilmediği takdirde aylık veya 6 aylık olarak uzatılmış sayılmaktadır. Kayıt silinmediği takdirde yeni döneme ilişkin ücret Üye/Veli tarafından kulübe ödenecektir.</p>
        <p><strong>4-) ÜCRET</strong><br>
        Üyelik bedeli, Üyelik satış formunda belirtilen üyelik paketine göre …. Ay, aylık…….. TL olup; işbu bedel Üye/Veli tarafından ödenecektir.</p>
        <p><strong>5-) ÖDEMELER</strong><br>
        Ödemelerin her ayın 20’sine kadar belirtilen hesaba yapılması gerekmektedir. Dönem tarihlerine göre eksik ya da fazla ödeme durumu oluşabilir. Ödemelerin zamanında yapılmaması durumunda; Üye/Veli, yapacağı ödemenin %25’i tutarında cezai şart ödemeyi kabul ve taahhüt eder.</p>`;
        
        const part2 = `<p><strong>6-) ÜYELİK İPTALLERİ</strong><br>
        Her ayın 14’ü kayıt sildirme için son gündür. Bu tarihler sonrasında yapılan kayıt sildirmelerde yeni dönem ücreti tahsil edilir. Kulübe veya kulüp tesislerine zarar verici davranışlarda bulunulması durumunda kulüp üyeliği sonlandırılabilir.</p>
        <p><strong>7-) EĞİTİME İLİŞKİN KURALLAR</strong><br>
        A) Üyelik Şartları ile Üye/Velinin Hak ve Yükümlülükleri<br>
        1) Eğitmen, her türlü üyelik talebini hiçbir gerekçe göstermeksizin tek taraflı olarak reddetme hakkına sahiptir.<br>
        2) Eğitmenden, suç işlememiş ve herhangi bir yüz kızartıcı suçtan sabıka kaydı bulunmayan T.C. vatandaşları ile yabancı uyruklu kişiler ders alabilir.<br>
        3) Eğitmen Üye/Veliden, bulaşıcı hastalıklar gibi toplumu veya diğer Üye/Velilerin sağlığını tehlikeye düşürebilecek bir hastalığının bulunmadığına dair sağlık raporu ya da tahlil sonucu talep edebilir.<br>
        B) KULÜP KURALLARI<br>
        a) Grup dersleri aylık 8 derstir.<br>
        b) Grup derslerinde ders bir kez işlendiğinden, üyenin katılamadığı dersler için telafi yapılmaz.<br>
        c) Özel ders paketleri 1 aylık süreyle geçerlidir. Bu süre içinde kullanılmayan ders hakları bir sonraki aya devredilmez.<br>
        C) GENEL KURALLAR<br>
        1) Kulüp bünyesinde Üye/Veliler genel nezaket kurallarına uymakla yükümlüdürler.<br>
        2) Kayıp eşyalardan Kulüp sorumlu değildir.<br>
        3) Üye/Veli ruhsatlı bile olsa Kulüp’e delici, kesici ve patlayıcı alet veya silahla giremez.`;
        
        const part3 = `<p><strong>8- KİŞİSEL VE ÖZEL NİTELİKLİ KİŞİSEL VERİLERİN İŞLENMESİ</strong><br>
        Üye/Veli, işbu sözleşmeye taraf olma suretiyle, verdiği tüm bilgilerin ve/veya Üye/Velilik ilişkisinin devamına herhangi bir suretle Kulüp’e verdiği tüm kişisel bilgilerinin işlenmesine açıkça izin verdiğini kabul, beyan ve taahhüt eder.</p>
        <p><strong>9-) SON HÜKÜMLER</strong><br>
        1) Bu anlaşmanın uygulanmasından kaynaklanan tüm ihtilaflarda Samsun mahkemeleri ve icra daireleri yetkilidir.<br>
        2) Tarafların sözleşmenin girişinde unvanları altında adresler sözleşme uyarınca kanuni tebligat adresleri olarak kabul edilecektir.<br>
        -Reşit olmayan katılımcıların velileri veya vasileri için Üye, işbu belge ile aşağıda adı geçen katılımcı için yasal sorumluluğu olan bir veli/vasi olarak, yukarıda belirtilen şekilde şahsın ibrasına muvafakat ettiğini ve ibrayı kabul ettiğini beyan eder.</p>`;

        return [part1, part2, part3];
    };
    
    const fullContractHtml = getContractSections().join('<hr>');
    contractTextArea.innerHTML = fullContractHtml;

    // --- FORM İNTERAKTİVİTESİ ---
    const durationSelect = document.getElementById('membershipDuration');
    durationSelect.addEventListener('change', function() {
        document.getElementById('monthlyWarning').style.display = (this.value === 'Aylık') ? 'block' : 'none';
        document.getElementById('fourMonthWarning').style.display = (this.value === '4 Aylık') ? 'block' : 'none';
    });

    const isMinorCheck = document.getElementById('isMinorCheck');
    const minorFullNameInput = document.getElementById('minorFullName');
    const minorDobInput = document.getElementById('minorDob');
    isMinorCheck.addEventListener('change', function() {
        const isChecked = this.checked;
        document.getElementById('minorFields').style.display = isChecked ? 'block' : 'none';
        minorFullNameInput.required = isChecked;
        minorDobInput.required = isChecked;
    });

    // --- İMZA CANVAS ---
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let hasSignature = false;
    function resizeCanvas(){const container=canvas.parentElement;canvas.width=Math.min(400,container.clientWidth-60);canvas.height=200;ctx.strokeStyle="#2d5a27";ctx.lineWidth=2;ctx.lineCap="round"}window.addEventListener("resize",resizeCanvas);resizeCanvas();let isDrawing=!1;const getCoords=e=>{const t=canvas.getBoundingClientRect(),n=e.touches?e.touches[0]:null;return{x:(n?n.clientX:e.clientX)-t.left,y:(n?n.clientY:e.clientY)-t.top}},startDrawing=e=>{e.preventDefault(),isDrawing=!0,hasSignature=!0;const{x:t,y:n}=getCoords(e);ctx.beginPath(),ctx.moveTo(t,n)},draw=e=>{if(!isDrawing)return;e.preventDefault();const{x:t,y:n}=getCoords(e);ctx.lineTo(t,n),ctx.stroke()},stopDrawing=()=>{isDrawing=!1};canvas.addEventListener("mousedown",startDrawing);canvas.addEventListener("mousemove",draw);canvas.addEventListener("mouseup",stopDrawing);canvas.addEventListener("mouseout",stopDrawing);canvas.addEventListener("touchstart",startDrawing);canvas.addEventListener("touchmove",draw);canvas.addEventListener("touchend",stopDrawing);function clearSignature(){ctx.clearRect(0,0,canvas.width,canvas.height),hasSignature=!1,document.getElementById("signatureWarning").style.display="none"}
    
    // --- ANA FORM GÖNDERME MANTIĞI ---
    document.getElementById('membershipForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        if (!hasSignature) { document.getElementById('signatureWarning').style.display = 'block'; return; }
        
        const submitBtn = document.getElementById('submitBtn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'İşleniyor...';

        const formData = Object.fromEntries(new FormData(this).entries());
        formData.timestamp = new Date().toISOString();
        formData.signature = canvas.toDataURL('image/png');

        try {
            // 1. Kullanıcı için RESİMLERİ oluştur ve indir
            await downloadAsImages(formData);

            // 2. Webhook'a veriyi gönder
            try {
                 await fetch(webhookUrl, {
                    method: 'POST',
                    body: JSON.stringify(formData),
                    headers: { 'Content-Type': 'application/json' },
                    mode: 'no-cors'
                });
            } catch (webhookError) {
                console.error("Webhook gönderim hatası (Bu hata normal olabilir):", webhookError);
            }

            document.getElementById('successMessage').style.display = 'block';
            this.reset();
            clearSignature();
            document.getElementById('monthlyWarning').style.display = 'none';
            document.getElementById('fourMonthWarning').style.display = 'none';
            document.getElementById('minorFields').style.display = 'none';

        } catch (error) {
            console.error("Ana işlem sırasında hata oluştu:", error);
            alert("Bir hata oluştu. Lütfen tekrar deneyin.");
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = '📄 Sözleşmeyi İmzala ve Onayla';
        }
    });

    // --- YENİ VE GÜVENİLİR RESİM OLUŞTURMA FONKSİYONU ---
    async function downloadAsImages(data) {
        
        const generatePageHtml = (pageNumber, pageContent, d, totalPages) => {
            const isFirstPage = pageNumber === 1;
            const isLastPage = pageNumber === totalPages;

            const headerHtml = isFirstPage ? `
                <div class="pdf-section">
                    <h3>ÜYE / VELİ BİLGİLERİ</h3>
                    <p><strong>Ad Soyad:</strong> ${d.Ad_Soyad}</p>
                    <p><strong>T.C. Kimlik No:</strong> ${d.TC_Kimlik_No}</p>
                    <p><strong>Telefon:</strong> ${d.Telefon}</p>
                    <p><strong>E-posta:</strong> ${d.Eposta}</p>
                    <p><strong>Adres:</strong> ${d.Adres}</p>
                    <p><strong>Üyelik Süresi:</strong> ${d.Uyelik_Suresi}</p>
                </div>
            ` + (d.Resit_Olmayan_Uye_Mi === 'on' ? `
                <div class="pdf-section">
                    <h3>REŞİT OLMAYAN ÜYE BİLGİLERİ</h3>
                    <p><strong>Adı Soyadı:</strong> ${d.Resit_Olmayan_Adi_Soyadi}</p>
                    <p><strong>Doğum Tarihi:</strong> ${d.Resit_Olmayan_Dogum_Tarihi}</p>
                </div>` : '') : '';
            
            const footerHtml = isLastPage ? `
                <div class="pdf-section signature-block">
                    <h3>ONAY VE İMZA</h3>
                    <p>Yukarıdaki sözleşmeyi okuduğumu, anladığımı ve tüm şartlarını kabul ettiğimi beyan ederim.</p>
                    <p><strong>İmza Tarihi:</strong> ${new Date(d.timestamp).toLocaleString('tr-TR')}</p>
                    <div class="signature-container">
                         <img src="${d.signature}" />
                         <p><strong>İsim Soyisim:</strong><br>${d.Ad_Soyad}</p>
                    </div>
                </div>
            ` : '';

            return `
            <!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8">
            <style>
                body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 12px; line-height: 1.5; color: #333; }
                .pdf-container { width: 800px; margin: 0 auto; padding: 40px; background: white; border: 1px solid #ccc; display: flex; flex-direction: column; height: 1120px; }
                h1 { font-size: 24px; text-align: center; color: #2d5a27; border-bottom: 2px solid #2d5a27; padding-bottom: 10px; margin-bottom: 20px; }
                .pdf-section { margin-bottom: 15px; padding: 15px; border: 1px solid #e1e5e9; border-radius: 10px; }
                .pdf-section h3 { font-size: 16px; color: #667eea; margin-top: 0; margin-bottom: 10px; }
                .contract { font-size: 10px; flex-grow: 1; } p { margin: 0 0 5px 0; }
                .signature-container { display: flex; align-items: flex-end; margin-top: 20px; }
                .signature-container img { width: 200px; border-bottom: 1px solid #ccc; }
                .signature-container p { margin-left: 20px; padding-bottom: 5px; }
                .page-footer { text-align: center; margin-top: auto; font-size: 10px; color: #888; padding-top: 20px;}
            </style>
            </head><body>
                <div class="pdf-container">
                    <div>
                        <h1>Atakum Tenis Kulübü Üyelik Sözleşmesi</h1>
                        ${headerHtml}
                        <div class="pdf-section contract">
                            <h3>SÖZLEŞME METNİ</h3>
                            ${pageContent}
                        </div>
                        ${footerHtml}
                    </div>
                    <div class="page-footer">Sayfa ${pageNumber} / ${totalPages}</div>
                </div>
            </body></html>`;
        };
        
        const contractParts = getContractSections();

        for (let i = 0; i < contractParts.length; i++) {
            const pageHtml = generatePageHtml(i + 1, contractParts[i], data, contractParts.length);
            
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px'; // Ekran dışında render et
            tempContainer.innerHTML = pageHtml;
            document.body.appendChild(tempContainer);

            const canvas = await html2canvas(tempContainer.querySelector('.pdf-container'), {
                scale: 2,
                useCORS: true
            });

            document.body.removeChild(tempContainer);

            const link = document.createElement('a');
            link.download = `${data.Ad_Soyad.replace(/\s+/g, '_')}_sayfa_${i + 1}.jpeg`;
            link.href = canvas.toDataURL('image/jpeg', 0.98);
            link.click();
            
            await new Promise(resolve => setTimeout(resolve, 500)); 
        }
    }
</script>
</body>
</html>

