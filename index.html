async function downloadPDF(data) {
        
        // 1. PDF iÃ§in optimize edilmiÅŸ HTML ÅŸablonu oluÅŸtur
        const generatePdfHtml = (d) => {
            const minorHtml = d.Resit_Olmayan_Uye_Mi === 'on' ? `
                <div class="section">
                    <h3>REÅžÄ°T OLMAYAN ÃœYE BÄ°LGÄ°LERÄ°</h3>
                    <p><strong>AdÄ± SoyadÄ±:</strong> ${d.Resit_Olmayan_Adi_Soyadi || 'Belirtilmedi'}</p>
                    <p><strong>DoÄŸum Tarihi:</strong> ${d.Resit_Olmayan_Dogum_Tarihi || 'Belirtilmedi'}</p>
                </div>
            ` : '';

            // SÃ¶zleÅŸme metnindeki tÃ¼m yer tutucularÄ± gerÃ§ek verilerle deÄŸiÅŸtir
            let filledContract = contractContent;
            const replacements = [
                { search: '[Bu alan formdan otomatik doldurulacaktÄ±r]', replace: d.Ad_Soyad },
                { search: /\[Bu alan formdan otomatik doldurulacaktÄ±r\]/g, replace: function(match, offset, string) {
                    // Ä°lk geÃ§en iÃ§in Ad Soyad, ikinci iÃ§in Adres, Ã¼Ã§Ã¼ncÃ¼ iÃ§in TC, dÃ¶rdÃ¼ncÃ¼ iÃ§in Telefon, beÅŸinci iÃ§in E-posta
                    const beforeText = string.substring(0, offset);
                    const adSoyadCount = (beforeText.match(/AdÄ±-SoyadÄ±/g) || []).length;
                    const adresCount = (beforeText.match(/Adres :/g) || []).length;
                    const tcCount = (beforeText.match(/TCKN :/g) || []).length;
                    const telefonCount = (beforeText.match(/Telefon :/g) || []).length;
                    
                    if (adSoyadCount > adresCount) return d.Ad_Soyad;
                    else if (adresCount > tcCount) return d.Adres;
                    else if (tcCount > telefonCount) return d.TC_Kimlik_No;
                    else if (telefonCount === 1) return d.Telefon;
                    else return d.Eposta;
                }}
            ];

            // TÃ¼m deÄŸiÅŸtirmeleri uygula
            filledContract = filledContract.replace(/\[Bu alan formdan otomatik doldurulacaktÄ±r\]/g, function(match, offset, string) {
                const beforeText = string.substring(0, offset);
                if (beforeText.includes('AdÄ±-SoyadÄ± :') && !beforeText.includes('TCKN :')) return d.Ad_Soyad;
                else if (beforeText.includes('Adres :') && !beforeText.includes('TCKN :')) return d.Adres;
                else if (beforeText.includes('TCKN :')) return d.TC_Kimlik_No;
                else if (beforeText.includes('Telefon :')) return d.Telefon;
                else return d.Eposta;
            });

            return `
            <!DOCTYPE html>
            <html lang="tr">
            <head>
                <meta charset="UTF-8">
                <style>
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    @page { 
                        margin: 15mm; 
                        size: A4; 
                        orphans: 2;
                        widows: 2;
                    }
                    body { 
                        font-family: 'Times New Roman', serif; 
                        font-size: 11px; 
                        line-height: 1.4; 
                        color: #000; 
                        background: white;
                        margin: 0;
                        padding: 0;
                    }
                    .pdf-container { 
                        width: 100%; 
                        margin: 0; 
                        padding: 0;
                        background: white;
                    }
                    h1 { 
                        font-size: 16px; 
                        text-align: center; 
                        color: #000; 
                        border-bottom: 1px solid #000; 
                        padding-bottom: 8px; 
                        margin-bottom: 15px;
                        page-break-after: avoid;
                    }
                    .section { 
                        margin-bottom: 15px; 
                        padding: 10px; 
                        border: 1px solid #ccc; 
                        page-break-inside: avoid;
                        background: white;
                    }
                    .section h3 { 
                        font-size: 12px; 
                        color: #000; 
                        margin: 0 0 8px 0;
                        page-break-after: avoid;
                        font-weight: bold;
                    }
                    .section p {
                        margin-bottom: 4px;
                        page-break-inside: avoid;
                    }
                    .contract { 
                        font-size: 9px;
                        line-height: 1.3;
                    }
                    .contract h4 {
                        font-size: 11px;
                        margin: 10px 0 5px 0;
                        page-break-after: avoid;
                    }
                    .contract p {
                        margin-bottom: 6px;
                        text-align: justify;
                    }
                    .signature-block { 
                        margin-top: 20px;
                        page-break-inside: avoid;
                    }
                    .signature-img {
                        width: 180px;
                        height: auto;
                        margin: 8px 0;
                        border-bottom: 1px solid #000;
                        display: block;
                    }
                    strong { font-weight: bold; }
                    .no-break { page-break-inside: avoid; }
                </style>
            </head>
            <body>
                <div class="pdf-container">
                    <h1>ðŸŽ¾ Atakum Tenis KulÃ¼bÃ¼ Ãœyelik SÃ¶zleÅŸmesi</h1>
                    
                    <div class="section no-break">
                        <h3>ÃœYE / VELÄ° BÄ°LGÄ°LERÄ°</h3>
                        <p><strong>Ad Soyad:</strong> ${d.Ad_Soyad}</p>
                        <p><strong>T.C. Kimlik No:</strong> ${d.TC_Kimlik_No}</p>
                        <p><strong>Telefon:</strong> ${d.Telefon}</p>
                        <p><strong>E-posta:</strong> ${d.Eposta}</p>
                        <p><strong>Adres:</strong> ${d.Adres}</p>
                        <p><strong>Ãœyelik SÃ¼resi:</strong> ${d.Uyelik_Suresi}</p>
                    </div>
                    
                    ${minorHtml}

                    <div class="section contract">
                        <h3>SÃ–ZLEÅžME METNÄ°</h3>
                        ${filledContract}
                    </div>

                    <div class="section signature-block no-break">
                        <h3>ONAY VE Ä°MZA</h3>
                        <p>YukarÄ±daki sÃ¶zleÅŸmeyi okuduÄŸumu, anladÄ±ÄŸÄ±mÄ± ve tÃ¼m ÅŸartlarÄ±nÄ± kabul ettiÄŸimi beyan ederim.</p>
                        <p><strong>Ä°mza Tarihi:</strong> ${new Date(d.timestamp).toLocaleString('tr-TR')}</p>
                        <p><strong>Dijital Ä°mza:</strong></p>
                        <img src="${d.signature}" class="signature-img" alt="Dijital Ä°mza"/>
                        <p style="margin-top: 10px;"><strong>Ä°mza Sahibi:</strong> ${d.Ad_Soyad}</p>
                    </div>
                </div>
            </body>
            </html>
            `;
        };
        
        const pdfHtmlContent = generatePdfHtml(data);

        // Optimize edilmiÅŸ PDF ayarlarÄ±
        const opt = {
            margin: [10, 10, 10, 10], // mm cinsinden kenar boÅŸluklarÄ± [Ã¼st, saÄŸ, alt, sol]
            filename: `${data.Ad_Soyad.replace(/\s+/g, '_')}_Tenis_Sozlesme_${new Date().toISOString().split('T')[0]}.pdf`,
            image: { 
                type: 'jpeg', 
                quality: 0.95 
            },
            html2canvas: { 
                scale: 1.5, 
                useCORS: true, 
                letterRendering: true,
                allowTaint: true,
                backgroundColor: '#ffffff',
                logging: false,
                width: 794, // A4 geniÅŸliÄŸi (210mm * 3.779)
                height: 1123 // A4 yÃ¼ksekliÄŸi (297mm * 3.779)
            },
            jsPDF: { 
                unit: 'mm', 
                format: 'a4', 
                orientation: 'portrait',
                compress: true
            },
            pagebreak: { 
                mode: ['avoid-all', 'css', 'legacy']
            }
        };
        
        // PDF'i oluÅŸtur ve indir
        await html2pdf().set(opt).from(pdfHtmlContent).save();
    }
