<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spor KulÃ¼bÃ¼ - Ãœyelik SÃ¶zleÅŸmesi</title>
    <!-- Gerekli KÃ¼tÃ¼phaneler -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCytn56Jwtf2tOnftW8MjUtLoH3PgGQnqU",
            authDomain: "uyekayit-5964b.firebaseapp.com",
            projectId: "uyekayit-5964b",
            storageBucket: "uyekayit-5964b.appspot.com",
            messagingSenderId: "493041591853",
            appId: "1:493041591853:web:939cb6494e8469ad133aa4"
        };
        
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.firebase = { collection, addDoc, getDocs, updateDoc, doc, query, where };
    </script>
    
    <style>
        :root {
            --primary-color: #0891b2; /* CanlÄ± CamgÃ¶beÄŸi */
            --secondary-color: #7c3aed; /* CanlÄ± Mor */
            --success-color: #16a34a;
            --danger-color: #dc2626;
            --dark-color: #1f2937;
            --light-color: #f9fafb;
            --border-color: #e5e7eb;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #e0e7ff 100%); /* AÃ§Ä±k ve modern arkaplan */
            min-height: 100vh; 
            padding: 20px; 
            color: #333; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { 
            max-width: 900px; 
            width: 100%;
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.1); 
            overflow: hidden; 
        }
        .header { 
            background: linear-gradient(45deg, var(--primary-color) 0%, var(--secondary-color) 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .form-container { padding: 30px 40px; }
        
        #progress-bar { display: flex; justify-content: space-between; margin-bottom: 30px; position: relative; }
        #progress-bar::before { content: ''; position: absolute; top: 50%; left: 0; transform: translateY(-50%); height: 4px; width: 100%; background-color: var(--border-color); z-index: 1; }
        #progress-line { position: absolute; top: 50%; left: 0; transform: translateY(-50%); height: 4px; background-color: var(--primary-color); z-index: 2; width: 0%; transition: width 0.3s ease; }
        .progress-step { position: relative; z-index: 3; width: 30px; height: 30px; background-color: white; border: 3px solid var(--border-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--border-color); transition: all 0.3s ease; }
        .progress-step.active { border-color: var(--primary-color); background-color: var(--primary-color); color: white; }

        .form-step { display: none; }
        .form-step.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title { font-size: 1.5em; color: var(--dark-color); margin-bottom: 25px; text-align: center; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        label { font-weight: 600; margin-bottom: 8px; font-size: 0.95em; }
        input, select, textarea { padding: 12px 15px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 1em; transition: all 0.3s ease; width: 100%; background-color: var(--light-color); }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(8, 145, 178, 0.2); }
        
        .contract-text { background: white; padding: 25px; border-radius: 10px; border: 2px solid var(--border-color); height: 350px; overflow-y: auto; font-size: 0.85em; line-height: 1.6; }
        .signature-section { background: var(--light-color); border-radius: 15px; padding: 30px; text-align: center; }
        .signature-canvas { border: 2px solid var(--border-color); border-radius: 10px; cursor: crosshair; display: block; margin: 20px auto; max-width: 100%; }
        
        .btn { padding: 12px 25px; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }
        .form-navigation { display: flex; justify-content: space-between; margin-top: 30px; }
        
        .checkbox-group { display: flex; align-items: flex-start; gap: 15px; margin: 20px 0; }
        .checkbox-group input { width: 20px; height: 20px; margin-top: 3px; flex-shrink: 0;}
        
        .alert { padding: 15px; border-radius: 8px; border: 1px solid transparent; margin-bottom: 20px; text-align: center; }
        .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
        .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }

        #pre-reg-not-found { display: none; }
        #paymentPlanContainer { display: none; padding: 25px; border-radius: 15px; background: var(--light-color); border-left: 5px solid var(--primary-color); }
        .payment-schedule { margin-top: 15px; }
        .payment-item-preview { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; background: white; border-radius: 5px; margin-bottom: 5px; border: 1px solid var(--border-color); }
        
        .admin-link { position: fixed; top: 20px; right: 20px; background: rgba(255,255,255,0.9); padding: 10px 15px; border-radius: 25px; text-decoration: none; color: var(--dark-color); font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: all 0.3s ease; backdrop-filter: blur(10px); z-index: 100; }
        .admin-link:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }

        #step-1 {
            background-color: #f0f5ff; /* AÃ§Ä±k mavi tonu */
            border: 1px solid #dde8ff;
            border-radius: 15px;
            padding: 25px;
        }
        #successMessage {
            padding: 50px 20px;
            min-height: 450px;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #successMessage h3 {
            font-size: 1.8em;
            color: var(--success-color);
        }
    </style>
</head>
<body>
    <a href="admin.html" class="admin-link">ğŸ¢ Admin Panel</a>
    
    <div class="container" id="main-container">
        <div class="header">
            <h1 id="clubNameHeader">Atakum Tenis KulÃ¼bÃ¼ - Mafen Spor KulÃ¼bÃ¼</h1>
            <p>Online Ãœyelik SÃ¶zleÅŸmesi</p>
        </div>
        <div class="form-container">
            <div id="progress-bar">
                <div class="progress-step active" data-step="1">1</div>
                <div class="progress-step" data-step="2">2</div>
                <div class="progress-step" data-step="3">3</div>
                <div class="progress-step" data-step="4">4</div>
                <div id="progress-line"></div>
            </div>

            <form id="membershipForm">
                <!-- Step 1: Pre-registration Check -->
                <div class="form-step active" id="step-1">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="branchSelection">BranÅŸ SeÃ§imi *</label>
                            <select id="branchSelection" required>
                                <option value="">SeÃ§iniz...</option>
                                <option value="tenis">ğŸ¾ Tenis</option>
                                <option value="yuzme">ğŸŠ YÃ¼zme</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="phone">Telefon NumaranÄ±z *</label>
                            <input type="tel" id="phone" required placeholder="Sistemdeki Ã¶n kayÄ±tÄ±nÄ±zÄ± bulmak iÃ§in lÃ¼tfen telefon numarasÄ± giriniz" pattern="0[0-g]{10}" maxlength="11" title="Telefon numarasÄ± 0 ile baÅŸlamalÄ± ve 11 haneli olmalÄ±dÄ±r.">
                        </div>
                    </div>
                    <div id="pre-reg-not-found" class="alert alert-danger" style="margin-top: 20px;">
                        <strong>Ã–n kayÄ±tÄ±nÄ±z bulunmamaktadÄ±r.</strong> LÃ¼tfen iletiÅŸime geÃ§iniz: 0362 363 00 64
                    </div>
                </div>

                <!-- Step 2: Information and Payment Plan -->
                <div class="form-step" id="step-2">
                     <h3 class="section-title">KayÄ±t Bilgileri ve Aidat Bilgileriniz</h3>
                     <div id="paymentPlanContainer"></div>
                </div>

                <!-- Step 3: Veli / Ãœye Bilgileri -->
                <div class="form-step" id="step-3">
                    <h3 class="section-title">KiÅŸisel Bilgiler</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="fullName">Ad Soyad (Veli/Ãœye) *</label><input type="text" id="fullName" name="Ad_Soyad" required readonly></div>
                        <div class="form-group"><label for="tcno">T.C. Kimlik No *</label><input type="text" id="tcno" name="TC_Kimlik_No" pattern="[0-9]{11}" maxlength="11" required></div>
                         <div class="form-group"><label for="address">Adres *</label><textarea id="address" name="Adres" rows="3" required></textarea></div>
                    </div>
                    <div id="minorFields" style="margin-top: 20px; display: none;">
                        <div class="form-grid">
                            <div class="form-group"><label for="minorFullName">Ã–ÄŸrenci AdÄ± SoyadÄ± *</label><input type="text" id="minorFullName" name="Resit_Olmayan_Adi_Soyadi"></div>
                            <div class="form-group"><label for="minorDob">Ã–ÄŸrenci DoÄŸum Tarihi *</label><input type="date" id="minorDob" name="Resit_Olmayan_Dogum_Tarihi"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Contract and Signature -->
                <div class="form-step" id="step-4">
                     <h3 class="section-title">SÃ¶zleÅŸme ve Ä°mza</h3>
                     <div class="checkbox-group">
                        <input type="checkbox" id="cancellationPolicyNew" name="CancellationPolicyNew" required>
                        <label for="cancellationPolicyNew">ÃœyeliÄŸiniz iptal edilene kadar devam etmektedir. Her ayÄ±n 14â€™Ã¼, yeni dÃ¶nem iÃ§in kayÄ±t iptali yapÄ±labilecek son gÃ¼ndÃ¼r. Bu tarihe kadar iptal edilmeyen kayÄ±tlar, devam eden dÃ¶nem iÃ§in geÃ§erli sayÄ±lÄ±r.</label>
                    </div>
                     <div class="contract-text" id="contractTextArea"></div>
                     <div class="checkbox-group">
                        <input type="checkbox" id="agreeContract" name="Sozlesme_Onayi" value="Kabul Edildi" required>
                        <label for="agreeContract">Ãœyelik sÃ¶zleÅŸmesini okudum, anladÄ±m ve kabul ediyorum. *</label>
                    </div>
                    <div class="signature-section">
                        <p>LÃ¼tfen aÅŸaÄŸÄ±daki alana imzanÄ±zÄ± atÄ±n:</p>
                        <canvas id="signatureCanvas" class="signature-canvas" width="400" height="200"></canvas>
                        <div><button type="button" class="btn btn-secondary" onclick="clearSignature()">Ä°mzayÄ± Temizle</button></div>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" id="prevBtn" style="display: none;">Geri</button>
                    <button type="button" class="btn btn-primary" id="nextBtn">Ä°leri</button>
                    <button type="submit" class="btn btn-success" id="submitBtn" style="display: none;">SÃ¶zleÅŸmeyi Onayla</button>
                </div>
                 <!-- BaÅŸarÄ± mesajÄ± formun iÃ§ine taÅŸÄ±ndÄ± -->
                 <div id="successMessage" class="alert alert-success">
                     <h3>ğŸ‰ ÃœyeliÄŸiniz TamamlandÄ±!</h3>
                     <p>Ãœyelik sÃ¶zleÅŸmeniz kulÃ¼bÃ¼mÃ¼ze baÅŸarÄ±yla ulaÅŸmÄ±ÅŸtÄ±r. Ailemize katÄ±ldÄ±ÄŸÄ±nÄ±z iÃ§in teÅŸekkÃ¼r eder, keyifli bir spor yolculuÄŸu dileriz.</p>
                 </div>
            </form>
        </div>
    </div>

<script>
    // --- STATE MANAGEMENT ---
    let currentStep = 1;
    let totalSteps = 4;
    let currentPreRegistration = null;
    
    // --- DOM ELEMENTS ---
    const steps = document.querySelectorAll(".form-step");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const submitBtn = document.getElementById("submitBtn");
    const form = document.getElementById('membershipForm');

    // --- CLUB & CONTRACT DATA ---
    const clubData = {
        tenis: { name: "Atakum Tenis KulÃ¼bÃ¼", icon: "ğŸ¾", officialName: "Atakum Tenis", contactName: "Aykut YILDIRIM", address: "Derecik Mahallesi 1444. Sokak No:1 Ä°lkadÄ±m/Samsun", taxNo: "9540639540", phone: "0544 936 75 43", email: "y.aykut7455@gmail.com" },
        yuzme: { name: "Mafen Spor KulÃ¼bÃ¼", icon: "ğŸŠ", officialName: "Mafen Spor KulÃ¼bÃ¼", contactName: "Aykut YILDIRIM", address: "Derecik Mahallesi 1444. Sokak No:1 Ä°lkadÄ±m/Samsun", taxNo: "9540639540", phone: "0544 936 75 43", email: "y.aykut7455@gmail.com" }
    };

    function generatePaymentTableForPdf(schedule) {
        if (!schedule || schedule.length === 0) return '';
        
        let tableHtml = `
        <p><strong>Aidat Takvimi:</strong></p>
        <table style="width: 100%; border-collapse: collapse; font-size: 8px; margin-top: 10px; page-break-inside: avoid;">
            <thead style="background-color: #f2f2f2;">
                <tr>
                    <th style="border: 1px solid #ddd; padding: 4px; text-align: left;">DÃ¶nem</th>
                    <th style="border: 1px solid #ddd; padding: 4px; text-align: left;">Tarih AralÄ±ÄŸÄ±</th>
                    <th style="border: 1px solid #ddd; padding: 4px; text-align: left;">Tutar</th>
                    <th style="border: 1px solid #ddd; padding: 4px; text-align: left;">Son Ã–deme</th>
                </tr>
            </thead>
            <tbody>
    `;

        schedule.forEach(p => {
            tableHtml += `
                <tr>
                    <td style="border: 1px solid #ddd; padding: 4px;">${p.paymentNumber}. Aidat</td>
                    <td style="border: 1px solid #ddd; padding: 4px;">${formatDate(p.period.start)} - ${formatDate(p.period.end)}</td>
                    <td style="border: 1px solid #ddd; padding: 4px;">${p.amount}â‚º</td>
                    <td style="border: 1px solid #ddd; padding: 4px;">${formatDate(p.dueDate)}</td>
                </tr>
            `;
        });

        tableHtml += `</tbody></table>`;
        return tableHtml;
    }
    
     const getContractSections = (club, data = {}, schedule = []) => {
        const { Ad_Soyad = '[Doldurulacak]', Adres = '[Doldurulacak]', TC_Kimlik_No = '[Doldurulacak]', Telefon = '[Doldurulacak]' } = data;
        const isChild = data.Resit_Olmayan_Adi_Soyadi;
        
        const part1 = `<h4>ÃœYELÄ°K SÃ–ZLEÅMESÄ°</h4>
        <p><strong>1-) TARAFLAR</strong><br>
        <strong>A-KULÃœP</strong><br>
        AdÄ±-SoyadÄ± : ${club.contactName}<br>
        ÃœnvanÄ± : ${club.officialName}<br>
        Adres : ${club.address}<br>
        Vergi No : ${club.taxNo}<br>
        Telefon : ${club.phone}<br>
        E-mail : ${club.email}<br>
        Bu sÃ¶zleÅŸmede bundan sonra "EÄÄ°TMEN/KULÃœP" olarak anÄ±lacaktÄ±r.<br>
        <strong>B-ÃœYE/VELÄ°</strong><br>
        AdÄ±-SoyadÄ± : ${Ad_Soyad}<br>
        Adres : ${Adres}<br>
        TCKN : ${TC_Kimlik_No}<br>
        Telefon : ${Telefon}<br>
        Bu sÃ¶zleÅŸmede bundan sonra "ÃœYE/VELÄ°" olarak anÄ±lacaktÄ±r. Ãœye ve varsa veliye ait bilgiler yukarÄ±da yer alan kÄ±sma ayrÄ± ayrÄ± yazÄ±larak doldurulacaktÄ±r.</p>
        <p>Ãœye/Veli iÅŸbu sÃ¶zleÅŸmeyi onaylamasÄ± sÄ±rasÄ±nda EÄŸitmen tarafÄ±ndan kendisinden talep edilen her tÃ¼rlÃ¼ bilgiyi eksiksiz ve doÄŸru olarak EÄŸitmene vermeyi kabul etmektedir. Ãœye/Veli, eÄŸitimler sÄ±rasÄ±nda EÄŸitmene bildirdiÄŸi bilgilerin doÄŸruluÄŸundan bizzat sorumludur.</p>
        <p>Ãœye/Veli, iÅŸbu sÃ¶zleÅŸmeye onayÄ± esnasÄ±nda beyan etmiÅŸ olduÄŸu cep telefonu numarasÄ± ve e-posta adresinin EÄŸitmen tarafÄ±ndan yapÄ±lacak her tÃ¼rlÃ¼ bildirim iÃ§in geÃ§erli tebligat mecralarÄ± sayÄ±lacaÄŸÄ±nÄ±, bu cep telefonu numarasÄ± ve e-posta adresinin kullanÄ±mÄ± ile ilgili her tÃ¼rlÃ¼ yetkinin kendisinde olduÄŸunu, ilgili cep telefonu numarasÄ± ve e-posta adresinin 3. kiÅŸiler tarafÄ±ndan kullanÄ±ldÄ±ÄŸÄ± ÅŸÃ¼phesinin varlÄ±ÄŸÄ± halinde bu durumu ve her halde cep telefonu numarasÄ± ve e-posta adresinde meydana gelen deÄŸiÅŸiklikleri EÄŸitmene bildirmekle yÃ¼kÃ¼mlÃ¼ olduÄŸunu kabul ve taahhÃ¼t eder.</p>`;
        
        const part2 = `<p><strong>2-) KONU</strong><br>
        Ä°ÅŸbu Ã¼yelik sÃ¶zleÅŸmesi, Ã¼yelik iÅŸlemlerinin gerÃ§ekleÅŸtirilmesi ile iÅŸbu sÃ¶zleÅŸmenin onaylanmasÄ± suretiyle, EÄŸitmen tarafÄ±ndan sunulacak hizmetin ÅŸartlarÄ±nÄ± ve taraflarÄ±n karÅŸÄ±lÄ±klÄ± hak ve yÃ¼kÃ¼mlÃ¼lÃ¼klerini dÃ¼zenlemektedir.</p>
        <p><strong>3-) SÃœRE</strong><br>
        SÃ¶zleÅŸme sÃ¼resi aylÄ±k ve 6 aylÄ±k periyotlar halinde dÃ¼zenlenmekte olup; kayÄ±tlar sÃ¶zleÅŸmenin biteceÄŸi ayÄ±n 15'inden Ã¶nce iptal edilmediÄŸi takdirde aylÄ±k veya 6 aylÄ±k olarak uzatÄ±lmÄ±ÅŸ sayÄ±lmaktadÄ±r. KayÄ±t silinmediÄŸi takdirde yeni dÃ¶neme iliÅŸkin Ã¼cret Ãœye/Veli tarafÄ±ndan kulÃ¼be Ã¶denecektir.</p>
        <p><strong>4-) ÃœCRET</strong><br>
        Ãœyelik bedeli, Ãœyelik satÄ±ÅŸ formunda belirtilen Ã¼yelik paketine gÃ¶re .... Ay, aylÄ±k.. TL olup; iÅŸbu bedel Ãœye/Veli tarafÄ±ndan Ã¶denecektir.</p>
        <p><strong>5-) Ã–DEMELER</strong><br>
        Ã–demelerin her ayÄ±n 20'sine kadar belirtilen hesaba yapÄ±lmasÄ± gerekmektedir. DÃ¶nem tarihlerine gÃ¶re eksik ya da fazla Ã¶deme durumu oluÅŸabilir. Ã–demelerin zamanÄ±nda yapÄ±lmamasÄ± durumunda; Ãœye/Veli, yapacaÄŸÄ± Ã¶demenin %25'i tutarÄ±nda cezai ÅŸart Ã¶demeyi kabul ve taahhÃ¼t eder.</p>
        <p>YapÄ±lan Ã¶demeler, derslere katÄ±lÄ±m taahhÃ¼dÃ¼ olarak kabul edilir. Ãœyenin derslere katÄ±lamamasÄ± sebebiyle Ã¼cret iadesi yapÄ±lmaz.</p>
        <p><strong>6-) ÃœYELÄ°K Ä°PTALLERÄ°</strong><br>
        Her ayÄ±n 14'Ã¼ kayÄ±t sildirme iÃ§in son gÃ¼ndÃ¼r. Bu tarihler sonrasÄ±nda yapÄ±lan kayÄ±t sildirmelerde yeni dÃ¶nem Ã¼creti tahsil edilir. KulÃ¼be veya kulÃ¼p tesislerine zarar verici davranÄ±ÅŸlarda bulunulmasÄ± durumunda kulÃ¼p Ã¼yeliÄŸi sonlandÄ±rÄ±labilir.</p>
        ${generatePaymentTableForPdf(schedule)}`;

        const part3 = `<p>1) DaimÃ® HastalÄ±k<br>
        Ãœyenin, Ã¼yelik sÃ¼resi iÃ§erisinde derslere gelmesini veya derslerdeki aktivitelere katÄ±lmasÄ±nÄ± engelleyecek daimÃ® bir hastalÄ±ÄŸa tutulmasÄ± ve bu durumun tam teÅŸekkÃ¼llÃ¼ devlet hastanesinden alÄ±nmÄ±ÅŸ heyet raporu ile belgelenmesi halinde Ã¼yelik iptal edilir. Ãœyenin Ã¼yelik Ã¼cretinin tamamÄ±nÄ± Ã¶demiÅŸ olmasÄ± durumunda, kullanÄ±lmayan sÃ¼reye ait Ã¶denen Ã¼cretten %.10kesinti yapÄ±larak, kalan tutar faizsiz olarak Ãœye/Veliye iade edilir. KullanÄ±lan hizmet sÃ¼resinin bedeli iade olunmaz. Ãœye/Veli, bu madde gereÄŸince iÅŸlem yapÄ±labilmesi iÃ§in, hastalÄ±ÄŸa iliÅŸkin raporunu Ã¼st yazÄ± ile birlikte EÄŸitmene verecektir. HastalÄ±ÄŸa iliÅŸkin raporun, rapor tarihinden itibaren en geÃ§ 10 gÃ¼n iÃ§erisinde verilmesi gerekmektedir. GeÃ§ verilen rapor ve dileÃ§eler iÅŸlem gÃ¶rmeyecek, geÃ§ersiz kabul edilecektir.</p>
        <p>2) EÄŸitmenin Tek TaraflÄ± Fesih HakkÄ±<br>
        EÄŸitmen taraflar arasÄ±ndaki iÅŸbu sÃ¶zleÅŸmeyi her zaman 5 gÃ¼n Ã¶nceden bildirimde bulunmak kaydÄ±yla herhangi bir gerekÃ§e gÃ¶stermeksizin tek taraflÄ± olarak feshedebilir.</p>
        <p>Ãœye/Veli, iÅŸbu sÃ¶zleÅŸmeyi imzalayarak bu maddeyi peÅŸinen kabul etmiÅŸ sayÄ±lÄ±r. Bu durumda EÄŸitmen Ãœyenin kullanÄ±lmayan sÃ¼reye iliÅŸkin Ãœyelik Ã¼cretini Ã¶demiÅŸ olmasÄ± durumunda, Ã¶demiÅŸ olduÄŸu Ã¼creti faizsiz olarak 5 gÃ¼n iÃ§erisinde Ãœye/Veliye iade edecektir.</p>
        <p>AyrÄ±ca EÄŸitmen haklÄ± bir nedenin varlÄ±ÄŸÄ± halinde sÃ¶zleÅŸmeyi herhangi bir sÃ¼re olmaksÄ±zÄ±n derhal tek taraflÄ± olarak da feshedebilir. Bu durumda, Ã¼yenin Ã¼yelik Ã¼cretinin kullanÄ±lmayan kÄ±smÄ± iade edilmez.</p>
        <p><strong>7-) EÄÄ°TÄ°ME Ä°LÄ°ÅKÄ°N KURALLAR</strong><br>
        A) Ãœyelik ÅartlarÄ± ile Ãœye/Velinin Hak ve YÃ¼kÃ¼mlÃ¼lÃ¼kleri<br>
        1) EÄŸitmen, her tÃ¼rlÃ¼ Ã¼yelik talebini hiÃ§bir gerekÃ§e gÃ¶stermeksizin tek taraflÄ± olarak reddetme hakkÄ±na sahiptir.<br>
        2) EÄŸitmenden, suÃ§ iÅŸlememiÅŸ ve herhangi bir yÃ¼z kÄ±zartÄ±cÄ± suÃ§tan sabÄ±ka kaydÄ± bulunmayan T.C. vatandaÅŸlarÄ± ile yabancÄ± uyruklu kiÅŸiler ders alabilir. EÄŸitmenin bu hususa iliÅŸkin adli sicil belgesi (sabÄ±ka kaydÄ±) talep etme ve deÄŸerlendirme hakkÄ± saklÄ±dÄ±r.<br>
        3) EÄŸitmen Ãœye/Veliden, bulaÅŸÄ±cÄ± hastalÄ±klar gibi toplumu veya diÄŸer Ãœye/Velilerin saÄŸlÄ±ÄŸÄ±nÄ± tehlikeye dÃ¼ÅŸÃ¼rebilecek bir hastalÄ±ÄŸÄ±nÄ±n bulunmadÄ±ÄŸÄ±na dair saÄŸlÄ±k raporu ya da tahlil sonucu talep edebilir. SÃ¶z konusu tahliller sonucunda bulaÅŸÄ±cÄ± hastalÄ±k ve benzeri bir bulguya rastlanmasÄ± halinde EÄŸitmen, ÃœyeliÄŸi yapacaÄŸÄ± bir fesih bildirimi ile sona erdirme hakkÄ±na haizdir.</p>
        <p>4) Ãœye/Veli, Ã¼yelik iÃ§in gerekli olan her tÃ¼rlÃ¼ belgeyi eksiksiz ve doÄŸru bir ÅŸekilde temin edecek; Ã¼yelik onayÄ± iÃ§in ve/veya Ã¼yeliÄŸin devamÄ± sÄ±rasÄ±nda EÄŸitmen tarafÄ±ndan talep edilecek her tÃ¼rlÃ¼ bilgi, belge, rapor vb. hususlarÄ± derhal temin ederek EÄŸitmene ibraz edecektir.</p>
        <p>5) Ãœyelerin spor faaliyetine katÄ±lmak iÃ§in gerekli saÄŸlÄ±k ÅŸartlarÄ±nÄ± taÅŸÄ±yÄ±p taÅŸÄ±madÄ±klarÄ±, spor aktivitesine uygun olup olmadÄ±klarÄ±, tÄ±bbi kontrollerini yaptÄ±rÄ±p yaptÄ±rmadÄ±klarÄ± veya saÄŸlÄ±k danÄ±ÅŸmanlarÄ±nÄ±n yaptÄ±ÄŸÄ± tÄ±bbi tavsiyelerden ya da bunlarÄ±n neticelerinden dolayÄ± EÄŸitmenin herhangi bir sorumluluÄŸu bulunmamaktadÄ±r. Ãœye/Veli, Ã¼yelik sÃ¶zleÅŸmesini imzaladÄ±ÄŸÄ± andan itibaren; saÄŸlÄ±k durumunun spor yapmaya elveriÅŸli olduÄŸunu, spor faaliyetine katÄ±lmasÄ±na engel bir Ã¶zrÃ¼ ve rahatsÄ±zlÄ±ÄŸÄ±nÄ±n bulunmadÄ±ÄŸÄ±nÄ±, faaliyete katÄ±lmasÄ±nÄ±n saÄŸlÄ±ÄŸÄ±na ve fiziksel durumuna bir zarar vermeyeceÄŸini beyan ve taahhÃ¼t etmiÅŸtir.</p>`;
        
        const part4 = `<p>6) Ãœyelerin, ders veya aktivitelerden faydalanmamalarÄ± halinde dahi belirlenen bedelleri zamanÄ±nda ve tam olarak Ã¶demeleri zorunludur. Ãœyelerin yapÄ±lacak aktivitelerden veya verilecek derslerden yararlanmamalarÄ± hiÃ§bir ÅŸekil ve ÅŸartta Ãœye/Veliye Ã¼yelik bedelini Ã¶dememe hakkÄ± vermemektedir. Ãœye derslerden yararlanmasa dahi Ãœyelika bedellerini Ã¶demek zorundadÄ±r.</p>
        <p>7) Ãœye/Veli, kendisinin veya misafirlerinin ÅŸahsi kusurlarÄ±, dikkatsizliÄŸi veya ihmalleri ile; kulÃ¼be veya 3. KiÅŸilere ait eÅŸyalar Ã¼zerinde meydana getirecekleri tÃ¼m hasar ve zarardan ve yine diÄŸer Ãœye/Velilerin yahut EÄŸitmen Ã§alÄ±ÅŸanlarÄ±nÄ±n ve 3. kiÅŸilerin uÄŸramÄ±ÅŸ olduÄŸu tÃ¼m zarar ve kayÄ±plardan sorumludur.</p>
        <p>B) KULÃœP KURALLARI<br>
        a) Grup dersleri aylÄ±k 8 derstir.<br>
        b) Grup derslerinde ders bir kez iÅŸlendiÄŸinden, Ã¼yenin katÄ±lamadÄ±ÄŸÄ± dersler iÃ§in telafi yapÄ±lmaz.<br>
        c) Ã–zel ders paketleri 1 aylÄ±k sÃ¼reyle geÃ§erlidir. Bu sÃ¼re iÃ§inde kullanÄ±lmayan ders haklarÄ± bir sonraki aya devredilmez.<br>
        d) Spor branÅŸlarÄ±nda herhangi bir kaza, yaralanma veya saÄŸlÄ±k problemi durumunda sorumluluk tamamen Ãœye/Veliye aittir.<br>
        e) KayÄ±t sildirme iÅŸlemi yapÄ±ldÄ±ÄŸÄ±nda sistem Ã¼zerinden tÃ¼m kiÅŸisel verileriniz ve kayÄ±t bilgileriniz silinir.<br>
        f) Ãœyelerin derse zamanÄ±nda, uygun kÄ±yafetle ve hazÄ±r ÅŸekilde gelmesi Ãœye/Velilerin sorumluluÄŸundadÄ±r.<br>
        g) KayÄ±t silme talebinde bulunan Ã¶ÄŸrencinin kalan dersleri mevcut dÃ¶nem tarihleri iÃ§erisinde yapÄ±lÄ±r.</p>
        <p>C) GENEL KURALLAR<br>
        1) KulÃ¼p bÃ¼nyesinde Ãœye/Veliler genel nezaket kurallarÄ±na uymakla yÃ¼kÃ¼mlÃ¼dÃ¼rler. Kort iÃ§inde veya dÄ±ÅŸÄ±nda nezaket kurallarÄ±na uymayan davranÄ±ÅŸlarda bulunan, huzuru kaÃ§Ä±ran, hakaret, kÃ¼fÃ¼r kullanan Ãœye/Velilerin Ãœye/Velilikleri herhangi bir uyarÄ±ya gerek kalmadan resen iptal edilebilir. Bu takdirde Ãœye/Velilik bedelleri kÄ±smen dahi geri Ã¶denmez.<br>
        2) KayÄ±p eÅŸyalardan KulÃ¼p sorumlu deÄŸildir.<br>
        3) Ãœye/Veli ruhsatlÄ± bile olsa KulÃ¼p'e delici, kesici ve patlayÄ±cÄ± alet veya silahla giremez. Aksi hallerde Ãœye/Veli KulÃ¼p'e giremeyecektir.<br>
        4) Ãœye/Velinin KapalÄ± alanlarda ve KulÃ¼p tarafÄ±ndan yasaklanan alanlarda sigara iÃ§mesi kesinlikle yasaktÄ±r.<br>
        5) KulÃ¼p iÃ§ine dÄ±ÅŸarÄ±dan yiyecek iÃ§ecek getirmek yasaktÄ±r.<br>
        6) Soyunma odalarÄ±ndaki dolaplar gÃ¼nlÃ¼k kullanÄ±m iÃ§indir. Ãœye/Velinin tek dolap kullanÄ±m hakkÄ± vardÄ±r.<br>
        7) Ãœye/Veliler, tÃ¼m eÅŸyalarÄ±nÄ± dolap iÃ§ine koymalÄ±, dolap kapaklarÄ±na ve/veya dÄ±ÅŸÄ±na herhangi bir eÅŸya asmamalÄ± ve dolaplarÄ±nÄ± kilitlemelidirler. Dolaplar kullanÄ±m sonrasÄ± tamamen boÅŸaltÄ±lmalÄ±dÄ±r.<br>
        8) Dolap iÃ§inde cep telefonlarÄ± sessiz konumda bÄ±rakÄ±lmalÄ±dÄ±r.</p>
        <p>9) GÃ¼nlÃ¼k dolaplar kullanÄ±m sonrasÄ± boÅŸ ve aÃ§Ä±k olarak bÄ±rakÄ±lmalÄ±dÄ±r. KulÃ¼p, hijyen ve gÃ¼venlik nedenleri ile gÃ¼n sonunda kilitli dolaplarÄ± gÃ¶revli yÃ¶netici eÅŸliÄŸinde aÃ§ma ve iÃ§indeki eÅŸyalarÄ± boÅŸaltma hakkÄ±na sahiptir. Dolapta bÄ±rakÄ±lan eÅŸyanÄ±n kaybolmasÄ±ndan veya hasarÄ±ndan KulÃ¼p sorumlu tutulamaz.</p>
        <p>10) Soyunma odalarÄ±nda gÃ¶rÃ¼ntÃ¼/ses kaydÄ± yapÄ±lmasÄ± kesinlikle yasaktÄ±r. Aksi davranÄ±ÅŸta bulunanlarÄ±n tespiti halinde, KulÃ¼p tarafÄ±ndan her tÃ¼rlÃ¼ hak saklÄ± tutulmak kaydÄ± ile Ãœye/Velilik feshi hÃ¼kÃ¼mleri uygulanabilecektir. Ãœye/Veli, soyunma odalarÄ±nda gerÃ§ekleÅŸtirilen gÃ¶rÃ¼ntÃ¼/ses kaydÄ±nÄ±n sonuÃ§larÄ±ndan KulÃ¼p'Ã¼n hiÃ§bir sorumluluÄŸu olmadÄ±ÄŸÄ±nÄ± kabul, beyan ve taahhÃ¼t eder.</p>
        <p>11) Soyunma odalarÄ±nda Ã¶zel ve deÄŸerli eÅŸya bÄ±rakÄ±lmamalÄ±dÄ±r. BÄ±rakÄ±lan eÅŸyalarÄ±n kaybolmasÄ±ndan veya hasarÄ±ndan KulÃ¼p sorumlu tutulamaz.</p>`;

        const part5 = `<p>12) KulÃ¼p, sunduÄŸu hizmetler ve Ã§alÄ±ÅŸmalar ile ilgili kurallar ve uygulamalarda, zaman ve ihtiyaca baÄŸlÄ± deÄŸiÅŸiklikler yapabilir, yeni maddeler ilave edebilir. Olabilecek bÃ¼tÃ¼n deÄŸiÅŸiklikler Ãœye/Velilere bildirilir.</p>
        <p>13) Tesisin tÃ¼m alanlarÄ±nda Ãœye/Velilerin hijyeni, saÄŸlÄ±ÄŸÄ± ve gÃ¼venliÄŸi dÃ¼ÅŸÃ¼nÃ¼lerek hazÄ±rlanan prosedÃ¼r ve kullanÄ±m kurallarÄ±na uyulmasÄ± zorunludur.</p>
        <p>14) KulÃ¼p sÄ±nÄ±rlarÄ± iÃ§erisinde (aÃ§Ä±k ve kapalÄ± alan fark etmeksizin) sigara iÃ§mek yasaktÄ±r.</p>
        <p><strong>8- KÄ°ÅÄ°SEL VE Ã–ZEL NÄ°TELÄ°KLÄ° KÄ°ÅÄ°SEL VERÄ°LERÄ°N Ä°ÅLENMESÄ°</strong><br>
        Ãœye/Veli, iÅŸbu sÃ¶zleÅŸmeye taraf olma suretiyle, verdiÄŸi tÃ¼m bilgilerin ve/veya Ãœye/Velilik iliÅŸkisinin devamÄ±na herhangi bir suretle KulÃ¼p'e verdiÄŸi tÃ¼m kiÅŸisel bilgilerinin, saÄŸlÄ±k geÃ§miÅŸi bilgilerinin, Ãœye/Velilik sÃ¼resince elde edilen kiÅŸisel ve Ã¶zel nitelikli kiÅŸisel verilerinin, Ãœye/Velilik bedelinin Ã¶denmesiyle baÄŸlantÄ±lÄ± olarak elektronik ve diÄŸer ortamlarda verilen/verilecek bilgilerin, "Veri Sorumlusu" sÄ±fatÄ±yla KulÃ¼p tarafÄ±ndan ve KulÃ¼p ortaklarÄ±, iÅŸ ortaklarÄ±, halefleri ve/veya bunlarÄ±n belirleyeceÄŸi Ã¼Ã§Ã¼ncÃ¼ kiÅŸiler tarafÄ±ndan, mezkur verilerin gizliliklerinin korunmasÄ± iÃ§in gerekli tedbirleri almak ve kiÅŸisel verilerin iÅŸlenmesine dair kanuni ilkelere uymak suretiyle otomatik olan/olmayan yÃ¶ntemler ile alÄ±nmasÄ±na, devralÄ±nmasÄ±na, yasal sÃ¼reler aÅŸÄ±lmamak Ã¼zere yurt iÃ§inde ve/veya yurt dÄ±ÅŸÄ±nda yazÄ±lÄ±/dijital arÅŸivlere kaydedilmesine, depolanmasÄ±na, muhafaza edilmesine, elde edilebilir hale getirilmesine, kullanÄ±lmasÄ±na, gÃ¼ncellenmesine, deÄŸiÅŸtirilmesine, yeniden dÃ¼zenlenmesine, sÄ±nÄ±flandÄ±rÄ±lmasÄ±na, yurt iÃ§inde veya yurt dÄ±ÅŸÄ±na aktarÄ±lmasÄ±na ve sair kanunlara uygun ÅŸekilde herhangi bir suretle iÅŸlenmesine, bu hususta KulÃ¼p tarafÄ±ndan Ã§eÅŸitli mecralar Ã¼zerinden aydÄ±nlatÄ±lmÄ±ÅŸ ve yasal haklarÄ± hakkÄ±nda bilgilindirilmiÅŸ olarak aÃ§Ä±kÃ§a izin(rÄ±za/onay) verdiÄŸini kabul, beyan ve taahhÃ¼t eder.</p>
        <p>1. Veri Sorumlusu:<br>${club.contactName}<br>${club.address}<br>${club.phone}<br>${club.email}</p>
        <p>2. KiÅŸisel Verilerin Ä°ÅŸlenme AmaÃ§larÄ±:<br>KiÅŸisel verileriniz; Ãœye/Velilik iÅŸlemleri, spor etkinliklerine katÄ±lÄ±m yÃ¶netimi, iletiÅŸim faaliyetleri, gÃ¼venlik kayÄ±tlarÄ±nÄ±n tutulmasÄ±, kulÃ¼p iÃ§i bilgilendirme ve organizasyon amaÃ§larÄ±yla iÅŸlenmektedir. AyrÄ±ca yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerimizi yerine getirmek, hukuki taleplere yanÄ±t vermek ve sizinle iletiÅŸim kurmak amacÄ±yla da kullanÄ±lmaktadÄ±r.</p>
        <p>3. Toplanan KiÅŸisel Veriler:<br>Ad, soyad, iletiÅŸim bilgileri, doÄŸum tarihi, spor etkinliklerine iliÅŸkin bilgiler gibi kiÅŸisel veriler toplanmaktadÄ±r.</p>
        <p>4. KiÅŸisel Verilerin Ä°ÅŸlenme Hukuki Sebepleri:<br>Verileriniz, KVKK'nÄ±n 5. ve 6. maddeleri kapsamÄ±nda; aÃ§Ä±k rÄ±za, sÃ¶zleÅŸmenin kurulmasÄ± veya ifasÄ±, yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerin yerine getirilmesi, haklarÄ±n tesisi, kullanÄ±lmasÄ± veya korunmasÄ± gibi hukuki sebepler doÄŸrÄŸultusunda iÅŸlenmektedir.</p>
        <p>5. KiÅŸisel Verilerin Saklama SÃ¼resi:<br>KiÅŸisel verileriniz, iÅŸlenme amacÄ±nÄ±n gerektirdiÄŸi sÃ¼re boyunca saklanacak, bu sÃ¼renin sonunda silinecek veya anonim hale getirilecektir.</p>
        <p>6. KiÅŸisel Veri Sahiplerinin HaklarÄ±:<br>KVKK uyarÄ±nca veri sahipleri;<br>â€¢ KiÅŸisel verilerinin iÅŸlenip iÅŸlenmediÄŸini Ã¶ÄŸrenme,<br>â€¢ Ä°ÅŸlenmiÅŸse buna iliÅŸkin bilgi talep etme,<br>â€¢ Ä°ÅŸleme amacÄ±nÄ± ve amaca uygun kullanÄ±lÄ±p kullanÄ±lmadÄ±ÄŸÄ±nÄ± Ã¶ÄŸrenme,<br>â€¢ Verilerin aktarÄ±ldÄ±ÄŸÄ± Ã¼Ã§Ã¼ncÃ¼ kiÅŸileri bilme,<br>â€¢ Eksik veya yanlÄ±ÅŸ iÅŸlenmiÅŸ verilerin dÃ¼zeltilmesini isteme,<br>â€¢ Verilerin silinmesini veya yok edilmesini talep etme,<br>â€¢ Bu iÅŸlemlerin Ã¼Ã§Ã¼ncÃ¼ kiÅŸilere bildirilmesini isteme,<br>â€¢ Otomatik sistemlerle analiz sonucu aleyhe Ã§Ä±kan sonuÃ§lara itraz etme hakkÄ±na sahiptir.</p>`;
        
        const part6 = `<p><strong>9-) SON HÃœKÃœMLER</strong><br>
        1) Bu anlaÅŸmanÄ±n uygulanmasÄ±ndan kaynaklanan tÃ¼m ihtilaflarda Samsun mahkemeleri ve icra daireleri yetkilidir.</p>
        <p>2) TaraflarÄ±n sÃ¶zleÅŸmenin giriÅŸinde unvanlarÄ± altÄ±nda adresler sÃ¶zleÅŸme uyarÄ±nca kanuni tebligat adresleri olarak kabul edilecek ve bu adreslere yapÄ±lan tebligatlar kendilerine yapÄ±lmÄ±ÅŸ sayÄ±lacaktÄ±r. Taraflardan biri adresinde meydana gelen deÄŸiÅŸikliÄŸi 5 (beÅŸ) gÃ¼n iÃ§erisinde diÄŸer tarafa bildirmediÄŸi takdirde yukarÄ±daki yer alan adreslere Tebligat Kanunu hÃ¼kÃ¼mleri dahilinde yapÄ±lacak ihbar ve tebligat muteber olacaktÄ±r.</p>
        <p>3)Ãœye/Veli, cep telefonu ve/veya e-mail adres deÄŸiÅŸikliÄŸini yazÄ±lÄ± olarak EÄŸitmene bildirmediÄŸi takdirde, bildirmiÅŸ olduÄŸu cep telefonu ve/veya e-posta adresine yapÄ±lacak bildirimlerin geÃ§erli olacaÄŸÄ±nÄ± ve kendisine tebligatÄ±n yapÄ±lmÄ±ÅŸ sayÄ±lacaÄŸÄ±nÄ± kabul, beyan ve taahhÃ¼t eder. Ä°ÅŸbu Ã¼yelik nedeniyle yapÄ±lacak her tÃ¼rlÃ¼ bildirim, sÃ¶zleÅŸmenin kabulÃ¼ sÄ±rasÄ±nda, Ã¼ye tarafÄ±ndan bildirilen cep telefonu ve/veya e posta adresine gÃ¶nderilecek mesaj aracÄ±lÄ±ÄŸÄ± ile saÄŸlanacaktÄ±r.</p>
        <p>ÃœYE/VELÄ° EÄÄ°TMEN<br>
        -ReÅŸit olmayan katÄ±lÄ±mcÄ±larÄ±n velileri veya vasileri iÃ§in Ãœye, iÅŸbu belge ile aÅŸaÄŸÄ±da adÄ± geÃ§en katÄ±lÄ±mcÄ± iÃ§in yasal sorumluluÄŸu olan bir veli/vasi olarak, yukarÄ±da belirtilen ÅŸekilde ÅŸahsÄ±n ibrasÄ±na muvafakat ettiÄŸini ve ibrayÄ± kabul ettiÄŸini beyan eder. YaÅŸÄ± kÃ¼Ã§Ã¼k Ã§ocuÄŸunun saÄŸlanan programlara katÄ±lÄ±mÄ± veya programlarla iliÅŸkisi nedeniyle meydana gelen her tÃ¼rlÃ¼ sorumluluk doÄŸuran olaylardan dolayÄ± KulÃ¼p'Ã¼, sahibini, ortaklarÄ±nÄ± ve Ã§alÄ±ÅŸanlarÄ±nÄ± sorumlu tutmayacaÄŸÄ±nÄ± taahhÃ¼t eder.</p>
        ${isChild ? `<p>ReÅŸit OlmayanÄ±n AdÄ± ve SoyadÄ±: ${data.Resit_Olmayan_Adi_Soyadi}<br>
        ReÅŸit OlmayanÄ±n DoÄŸum Tarihi: ${formatDate(data.Resit_Olmayan_Dogum_Tarihi)}<br>
        Velisinin/Vasisinin AdÄ± ve SoyadÄ±: ${data.Ad_Soyad}</p>` : ''}`;

        return [part1, part2, part3, part4, part5, part6];
    };


    // --- FORM NAVIGATION ---
    const updateProgressBar = () => {
        const progressSteps = document.querySelectorAll('.progress-step');
        const progressLine = document.getElementById('progress-line');
        progressSteps.forEach((step, index) => {
            step.classList.toggle('active', index < currentStep);
        });
        progressLine.style.width = `${((currentStep - 1) / (totalSteps - 1)) * 100}%`;
    };

    const showStep = (stepNumber) => {
        steps.forEach(step => step.classList.remove('active'));
        document.getElementById(`step-${stepNumber}`).classList.add('active');
        currentStep = stepNumber;
        updateProgressBar();
        
        prevBtn.style.display = currentStep > 1 ? 'inline-flex' : 'none';
        nextBtn.style.display = currentStep < totalSteps ? 'inline-flex' : 'none';
        submitBtn.style.display = currentStep === totalSteps ? 'inline-flex' : 'none';
    };
    
    // --- ADVANCE LOGIC ---
    async function attemptAdvanceFromStep1() {
        if (nextBtn.disabled) return; 

        const phoneInput = document.getElementById('phone');
        const phone = phoneInput.value;
        const branch = document.getElementById('branchSelection').value;

        if (phone.length !== 11 || !branch) {
            return; 
        }
        
        const phoneRegex = /^0[0-9]{10}$/;
        if (!phoneRegex.test(phone)) {
            return showAlert(phoneInput.title, 'danger', 'step-1');
        }

        nextBtn.disabled = true;
        nextBtn.textContent = 'Kontrol ediliyor...';
        try {
            const found = await checkPreRegistration(branch, phone);
            if (found) {
                showStep(currentStep + 1);
            }
        } finally {
            nextBtn.disabled = false;
            nextBtn.textContent = 'Ä°leri';
        }
    }

    document.getElementById('phone').addEventListener('input', function (e) {
        e.target.value = e.target.value.replace(/\D/g, '');
        attemptAdvanceFromStep1();
    });

    document.getElementById('branchSelection').addEventListener('change', attemptAdvanceFromStep1);

    nextBtn.addEventListener("click", async () => {
        if (currentStep === 1) {
            const phoneInput = document.getElementById('phone');
            const phone = phoneInput.value;
            const branch = document.getElementById('branchSelection').value;
            if (!branch || !phone) {
                return showAlert('LÃ¼tfen branÅŸ seÃ§in ve telefon numaranÄ±zÄ± girin.', 'danger', 'step-1');
            }
            await attemptAdvanceFromStep1();
        } else if (currentStep === 3) {
             const isMinor = currentPreRegistration.studentName && currentPreRegistration.parentName;
             if(isMinor && (!document.getElementById('minorFullName').value || !document.getElementById('minorDob').value)) {
                 return showAlert('LÃ¼tfen Ã¶ÄŸrenci adÄ±nÄ± ve doÄŸum tarihini girin.', 'danger', 'step-3');
             }
             if(!document.getElementById('tcno').value || !document.getElementById('address').value) {
                  return showAlert('LÃ¼tfen T.C. Kimlik No ve Adres alanlarÄ±nÄ± doldurun.', 'danger', 'step-3');
             }
             populateContractText();
             showStep(currentStep + 1);
        }
        else if (currentStep < totalSteps) {
            showStep(currentStep + 1);
        }
    });

    prevBtn.addEventListener("click", () => {
        if (currentStep > 1) showStep(currentStep - 1);
    });

    // --- PRE-REGISTRATION LOGIC ---
    async function checkPreRegistration(branch, phone) {
        if (!window.firebase || !window.db) return false;
        const notFoundDiv = document.getElementById('pre-reg-not-found');
        
        try {
            const q = window.firebase.query(
                window.firebase.collection(window.db, 'preRegistrations'),
                window.firebase.where('phone', '==', phone)
            );
            const querySnapshot = await window.firebase.getDocs(q);

            if (querySnapshot.empty) {
                notFoundDiv.style.display = 'block';
                currentPreRegistration = null;
                return false;
            }

            const matchingDoc = querySnapshot.docs.find(doc => {
                const data = doc.data();
                return data.branch === branch && data.status === 'pending_contract';
            });

            if (!matchingDoc) {
                notFoundDiv.style.display = 'block';
                currentPreRegistration = null;
                return false;
            }
            
            currentPreRegistration = { id: matchingDoc.id, ...matchingDoc.data() };
            
            notFoundDiv.style.display = 'none';
            populateFormWithPreRegData();
            return true;

        } catch (error) {
            console.error("Error checking pre-registration:", error);
            showAlert("KayÄ±t kontrol edilirken bir hata oluÅŸtu. LÃ¼tfen daha sonra tekrar deneyin.", "danger", "step-1");
            return false;
        }
    }

    function populateFormWithPreRegData() {
        const preReg = currentPreRegistration;
        const club = clubData[preReg.branch] || { name: 'Atakum Tenis KulÃ¼bÃ¼ - Mafen Spor KulÃ¼bÃ¼' };
        document.getElementById('clubNameHeader').textContent = club.name;
        document.getElementById('paymentPlanContainer').style.display = 'block';
        document.getElementById('paymentPlanContainer').innerHTML = generatePaymentPlanHtml(preReg);
        
        const isChild = !!(preReg.parentName && preReg.studentName);
        document.getElementById('fullName').value = preReg.parentName || preReg.studentName;
        
        const minorFieldsDiv = document.getElementById('minorFields');
        const minorNameInput = document.getElementById('minorFullName');
        const minorDobInput = document.getElementById('minorDob');
        
        if (isChild) {
            minorFieldsDiv.style.display = 'block';
            minorNameInput.value = preReg.studentName;
            minorNameInput.required = true;
            minorDobInput.value = preReg.studentBirthDate || '';
            minorDobInput.required = true;
        } else {
            minorFieldsDiv.style.display = 'none';
            minorNameInput.required = false;
            minorDobInput.required = false;
        }
    }
    
    function populateContractText() {
        const contractData = {
            Ad_Soyad: document.getElementById('fullName').value,
            TC_Kimlik_No: document.getElementById('tcno').value,
            Telefon: document.getElementById('phone').value,
            Adres: document.getElementById('address').value,
            Resit_Olmayan_Adi_Soyadi: document.getElementById('minorFullName').value,
            Resit_Olmayan_Dogum_Tarihi: document.getElementById('minorDob').value
        };
        const club = clubData[currentPreRegistration.branch];
        const contractSections = getContractSections(club, contractData, currentPreRegistration.paymentSchedule);
        document.getElementById('contractTextArea').innerHTML = contractSections.join('<hr style="margin: 20px 0;">');
    }

    function generatePaymentPlanHtml(preReg) {
       let infoHtml = '';
       if (preReg.studentName && preReg.parentName) { // Ã‡ocuk kaydÄ±
           infoHtml = `
                <p><strong>Veli:</strong> ${preReg.parentName}</p>
                <p><strong>Ã–ÄŸrenci:</strong> ${preReg.studentName}</p>`;
       } else { // YetiÅŸkin kaydÄ±
           infoHtml = `<p><strong>Ãœye:</strong> ${preReg.studentName || preReg.parentName}</p>`;
       }

       let planHtml = `${infoHtml}
            <h5 style="margin-top: 15px;">ğŸ“… Aidat Bilgileriniz:</h5>
            <p style="font-size: 0.9em; color: #555; margin-top: 5px; margin-bottom: 15px;">ÃœyeliÄŸiniz iptal edilene kadar devam etmektedir. Her ayÄ±n 14â€™Ã¼, yeni dÃ¶nem iÃ§in kayÄ±t iptali yapÄ±labilecek son gÃ¼ndÃ¼r. Bu tarihe kadar iptal edilmeyen kayÄ±tlar, devam eden dÃ¶nem iÃ§in geÃ§erli sayÄ±lÄ±r.</p>
            <div class="payment-schedule">`;

        if (preReg.paymentSchedule && preReg.paymentSchedule.length > 0) {
            preReg.paymentSchedule.forEach(p => {
                planHtml += `<div class="payment-item-preview">
                    <div>
                        <strong>${p.paymentNumber}. Aidat</strong> (${p.period.lessonCount || 'N/A'} Ders)<br>
                        <small>DÃ¶nem: ${formatDate(p.period.start)} - ${formatDate(p.period.end)}</small><br>
                        <small>Son Ã–deme Tarihi: ${formatDate(p.dueDate)}</small>
                    </div>
                    <span>${p.amount}â‚º</span>
                </div>`;
            });
        }
        planHtml += '</div>';
        return planHtml;
    }

    // --- SIGNATURE CANVAS ---
    const canvas = document.getElementById('signatureCanvas');
    const ctx = canvas.getContext('2d');
    let hasSignature = false;
    function resizeCanvas(){const p=canvas.parentElement;canvas.width=Math.min(400,p.clientWidth-60);canvas.height=200;ctx.strokeStyle="#343a40";ctx.lineWidth=2;ctx.lineCap="round"}window.addEventListener("resize",resizeCanvas);resizeCanvas();let isDrawing=!1;const getCoords=e=>{const t=canvas.getBoundingClientRect(),a=e.touches?e.touches[0]:null;return{x:(a?a.clientX:e.clientX)-t.left,y:(a?a.clientY:e.clientY)-t.top}},startDrawing=e=>{e.preventDefault(),isDrawing=!0,hasSignature=!0;const{x:t,y:a}=getCoords(e);ctx.beginPath(),ctx.moveTo(t,a)},draw=e=>{if(!isDrawing)return;e.preventDefault();const{x:t,y:a}=getCoords(e);ctx.lineTo(t,a),ctx.stroke()},stopDrawing=()=>{isDrawing=!1};canvas.addEventListener("mousedown",startDrawing),canvas.addEventListener("mousemove",draw),canvas.addEventListener("mouseup",stopDrawing),canvas.addEventListener("mouseout",stopDrawing),canvas.addEventListener("touchstart",startDrawing),canvas.addEventListener("touchmove",draw),canvas.addEventListener("touchend",stopDrawing);function clearSignature(){ctx.clearRect(0,0,canvas.width,canvas.height),hasSignature=!1}
    
    // --- FORM SUBMISSION & PDF ---
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        if (!hasSignature) return showAlert('LÃ¼tfen sÃ¶zleÅŸmeyi imzalayÄ±n.', 'danger', 'step-4');
        if (!currentPreRegistration) return showAlert('GeÃ§erli bir Ã¶n kayÄ±t bulunamadÄ±.', 'danger', 'step-4');
        if (!document.getElementById('agreeContract').checked || !document.getElementById('cancellationPolicyNew').checked) {
            return showAlert('LÃ¼tfen tÃ¼m sÃ¶zleÅŸme ve iptal koÅŸullarÄ±nÄ± onaylayÄ±n.', 'danger', 'step-4');
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Ä°ÅŸleniyor...';

        try {
            const formData = Object.fromEntries(new FormData(form).entries());
            formData.Telefon = document.getElementById('phone').value;
            formData.signature = canvas.toDataURL('image/png');
            formData.timestamp = new Date().toISOString();

            // 1. Create and download PDF
            const pdfDoc = await createPdf(formData);
            await pdfDoc.save(`${formData.Ad_Soyad.replace(/\s+/g, '_')}_sozlesme.pdf`);
            
            // 2. Update Member Record in Firebase
            const memberQuery = window.firebase.query(
                window.firebase.collection(window.db, 'members'),
                window.firebase.where('preRegistrationId', '==', currentPreRegistration.id)
            );
            const querySnapshot = await window.firebase.getDocs(memberQuery);
            
            if (!querySnapshot.empty) {
                const memberDocRef = querySnapshot.docs[0].ref;
                await window.firebase.updateDoc(memberDocRef, { 
                    status: 'active',
                    TC_Kimlik_No: formData.TC_Kimlik_No,
                    Adres: formData.Adres,
                    signature: formData.signature 
                });
            } else {
                 throw new Error("Ä°liÅŸkili Ã¼ye kaydÄ± bulunamadÄ±. LÃ¼tfen yÃ¶netici ile iletiÅŸime geÃ§in.");
            }

            // 3. Update Pre-registration Status
            await window.firebase.updateDoc(
                window.firebase.doc(window.db, 'preRegistrations', currentPreRegistration.id),
                { status: 'completed', completedAt: new Date().toISOString() }
            );
            
            // 4. Show Success
            document.getElementById('progress-bar').style.display = 'none';
            steps.forEach(step => step.style.display = 'none');
            document.querySelector('.form-navigation').style.display = 'none';
            document.getElementById('successMessage').style.display = 'flex';

        } catch (error) {
            console.error("Submission error:", error);
            showAlert("Bir hata oluÅŸtu: " + error.message, "danger", "step-4");
            submitBtn.disabled = false;
            submitBtn.textContent = 'SÃ¶zleÅŸmeyi Onayla';
        }
    });
    
    async function createPdf(data) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({ unit: 'pt', format: 'a4' });
        const club = clubData[currentPreRegistration.branch];
        const contractParts = getContractSections(club, data, currentPreRegistration.paymentSchedule);

        for (let i = 0; i < contractParts.length; i++) {
            if (i > 0) doc.addPage();
            
            const pageHtml = generatePageHtml(data, club, contractParts[i], i + 1, contractParts.length);
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.width = '595px'; // A4 width in points
            tempContainer.innerHTML = pageHtml;
            document.body.appendChild(tempContainer);
            
            const pageCanvas = await html2canvas(tempContainer, { scale: 2 });
            document.body.removeChild(tempContainer);
            
            const imgData = pageCanvas.toDataURL('image/jpeg', 0.9);
            const imgProps = doc.getImageProperties(imgData);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            
            doc.addImage(imgData, 'JPEG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
        }
        return doc;
    }

    function generatePageHtml(d, club, pageContent, pageNum, totalPages) {
        const headerTitle = document.getElementById('clubNameHeader').textContent;
        return `
        <!DOCTYPE html><html><head><meta charset="UTF-8"><style>
            body { font-family: 'Helvetica', 'Arial', sans-serif; font-size: 10px; line-height: 1.4; color: #333; width: 595px; }
            .pdf-page { padding: 40px; display: flex; flex-direction: column; height: 842px; /* A4 height in points */ box-sizing: border-box; }
            h1 { font-size: 18px; text-align: center; } h4 { font-size: 12px; margin-top: 15px; }
            .content { flex-grow: 1; }
            .footer { text-align: center; font-size: 9px; color: #888; border-top: 1px solid #ccc; padding-top: 10px; margin-top: auto; display: flex; justify-content: space-between; align-items: flex-end; }
            .signature-box img { width: 100px; height: 50px; }
            .signature-box p { margin: 0; font-size: 8px; }
        </style></head><body>
            <div class="pdf-page">
                <h1>${headerTitle} Ãœyelik SÃ¶zleÅŸmesi</h1>
                <div class="content">${pageContent}</div>
                <div class="footer">
                    <div class="signature-box">
                        <img src="${d.signature}" />
                        <p><strong>${d.Ad_Soyad}</strong></p>
                        <p>${new Date(d.timestamp).toLocaleString('tr-TR')}</p>
                    </div>
                    <div>Sayfa ${pageNum} / ${totalPages}</div>
                </div>
            </div>
        </body></html>`;
    }

    // --- HELPER FUNCTIONS ---
    function showAlert(message, type = 'danger', stepId) {
        const step = document.getElementById(stepId);
        if(!step) return;
        
        const existingAlert = step.querySelector('.alert-temp');
        if (existingAlert) existingAlert.remove();

        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-temp`;
        alertDiv.textContent = message;
        step.insertBefore(alertDiv, step.firstChild);
        setTimeout(() => alertDiv.remove(), 5000);
    }
    function formatDate(dateString) {
        if (!dateString) return '';
        // Add T00:00:00 to handle potential timezone issues
        return new Date(dateString + 'T00:00:00').toLocaleDateString('tr-TR');
    }
    
    // Initial setup
    showStep(1);
</script>
</body>
</html>
